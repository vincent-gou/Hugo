<!doctype html><html lang=fr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Variablisation des annotations dans Grafana</title>
<style>html body{font-family:raleway,sans-serif;background-color:#656565}:root{--accent:#cc9933;--border-width:5px}</style>
<link rel=stylesheet href=https://www.vincent-gou.fr/css/main.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script>$(document).on('click',function(){$('.collapse').collapse('hide')})</script>
<meta name=generator content="Hugo 0.92.2">
</head>
<script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<body>
<a class=flagselect href=/post/grafana_annotation_variables/>früá´üá∑</a>
<nav class="navbar navbar-default navbar-fixed-top">
<div class=container>
<div class=navbar-header>
<a class="navbar-brand visible-xs" href=#>Variablisation des annotations dans Grafana</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
</div>
<div class="collapse navbar-collapse">
<ul class="nav navbar-nav">
<li><a href=/>Accueil</a></li>
<li><a href=/project/>Projets</a></li>
<li><a href=/post/>Articles</a></li>
<li><a href=/tags/>Tags</a></li>
<li><a href=/resume/>C.V.</a></li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class=navbar-icon><a href=mailto:contact@vincent-gou.fr><i class="fa fa-envelope-o"></i></a></li>
<li class=navbar-icon><a href=https://github.com/vincent-gou/><i class="fa fa-github"></i></a></li>
<li class=navbar-icon><a href=https://www.linkedin.com/in/vincent-gou/><i class="fa fa-linkedin"></i></a></li>
<li class=navbar-icon><a href=https://www.malt.fr/profile/vincentgourrierec/><i class="fa fa-certificate"></i></a></li>
</ul>
</div>
</div>
</nav>
<h4 class=page_info>Informations sur la page: </h4>
<h6 class=page_info> Cet article contient 605 mots. </br> Comptez 3 minutes de temps de lecture</h6>
<main>
<div class=item>
<h4><a href=/post/grafana_annotation_variables/>Variablisation des annotations dans Grafana</a></h4>
<h5>December 9, 2020</h5>
<a href=https://www.vincent-gou.fr/tags/grafana><kbd class=item-tag>grafana</kbd></a>
<a href=https://www.vincent-gou.fr/tags/influxdb><kbd class=item-tag>influxdb</kbd></a>
</div>
<br> <div class=text-justify>
<div class=paragraph>
<p>Si vous avez essay√© d‚Äôafficher des annotations selon une variable d√©finie sur un dashboard sans succ√®s, cette page est faite pour vous.</p>
</div>
<div class=sect1>
<h2 id=_objectifs>1. Objectifs</h2>
<div class=sectionbody>
<div class=ulist>
<ul>
<li>
<p>Permettre d‚Äôafficher les annotations li√©es √† une variable sur un dashboard</p>
</li>
</ul>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_pr√©_requis>2. Pr√©-requis</h2>
<div class=sectionbody>
<div class=ulist>
<ul>
<li>
<p>Disposer d‚Äôun dashboard par client</p>
</li>
<li>
<p>Disposer d‚Äôun dashboard d‚Äôadministration de tous les clients avec une variable permettant de cibler le crit√®re de s√©lection.</p>
</li>
</ul>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_pr√©paration>3. Pr√©paration</h2>
<div class=sectionbody>
<div class=sect2>
<h3 id=_dashboard_client>3.1. Dashboard client</h3>
<div class=paragraph>
<p>Dans le menu "Dashboard settings" / Annotations, s√©lectionnez la ligne par d√©faut : "Annotations & Alerts (Built-in)" ou cr√©ez une nouvelle annotation.</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-00423.png alt=500 width=400>
</div>
</div>
<div class=paragraph>
<p>Le principe ici √©tant de d√©finir les tags qui seront utilis√©s pour afficher les annotations cr√©es dans l‚ÄôAPI Grafana et affich√©es dans ce Dashboard.</p>
</div>
<div class=paragraph>
<p>Vous pouvez donc d√©finir plusieurs tags "g√©n√©rique"et au moins un sp√©cifique.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class=icon>
<div class=title>Note</div>
</td>
<td class=content>
Pensez √† cliquer sur "Update" puis √† sauvegarder le dashboard.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class=icon>
<div class=title>Warning</div>
</td>
<td class=content>
Si vous cochez "Match any", la pr√©sence de n‚Äôimporte lequel des tags affichera l‚Äôannotation. Ce n‚Äôest pas l‚Äôeffet d√©sir√©, donc ne cochez cette option que si n√©cessaire.
</td>
</tr>
</tbody></table>
</div>
<div class=paragraph>
<p>Par exemple:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>extranet
editeur
client:client_xyz</code></pre>
</div>
</div>
</div>
<div class=sect2>
<h3 id=_dashboard_dadministration>3.2. Dashboard d‚Äôadministration</h3>
<div class=sect3>
<h4 id=_cr√©ation_dune_variable>3.2.1. Cr√©ation d‚Äôune variable</h4>
<div class=paragraph>
<p>Si vous n‚Äôavez pas de variable permettant de filtrer votre dashboard, cr√©ez en une.</p>
</div>
<div class=paragraph>
<p>Dans le menu "Dashboard settings" / Variables, ajoutez une nouvelle variable.</p>
</div>
<div class=paragraph>
<p>Renseignez les informations d‚Äôaffichage et la requete de s√©lection:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-ae422.png alt=500 width=400>
</div>
</div>
<div class=paragraph>
<p>Puis cliquez sur "Update" et "Save Dashboard"</p>
</div>
<div class=paragraph>
<p>Un bouton contenant la liste des valeurs issues de la requ√™te sera disponible sur votre Dashboard:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-0bb4d.png alt=500 width=400>
</div>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-bfefa.png alt=500 width=400>
</div>
</div>
</div>
<div class=sect3>
<h4 id=_cr√©ation_dun_bouton_de_s√©lection_des_annotations_utilisant_une_partie_des_tags_des_dashboard_client>3.2.2. Cr√©ation d‚Äôun bouton de s√©lection des annotations utilisant une partie des tags des dashboard client</h4>
<div class=paragraph>
<p>Dans le menu "Dashboard settings" / Annotations, s√©lectionnez la ligne par d√©faut : "Annotations & Alerts (Built-in)" ou cr√©ez une nouvelle annotation.</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-9044a.png alt=500 width=400>
</div>
</div>
<div class=paragraph>
<p>Le principe ici √©tant de d√©finir une annotation utilisant les tags des dashboard client sans le tag sp√©cifique du client.</p>
</div>
<div class=paragraph>
<p>Par exemple:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>extranet
editeur</code></pre>
</div>
</div>
</div>
<div class=sect3>
<h4 id=_cr√©ation_dun_bouton_de_s√©lection_des_annotations_utilisant_les_tags_et_une_variable_d√©finie_dans_le_dashboard_dadministration>3.2.3. Cr√©ation d‚Äôun bouton de s√©lection des annotations utilisant les tags et une variable d√©finie dans le dashboard d‚Äôadministration</h4>
<div class=paragraph>
<p>Dans le menu "Dashboard settings" / Annotations, s√©lectionnez la ligne par d√©faut : "Annotations & Alerts (Built-in)" ou cr√©ez une nouvelle annotation.</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-fc253.png alt=500 width=400>
</div>
</div>
<div class=paragraph>
<p>Le principe ici √©tant de d√©finir une annotation utilisant les tags des dashboard client avec le tag sp√©cifique du client sp√©cifi√©.</p>
</div>
<div class=paragraph>
<p>Par exemple:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>extranet
editeur
client:$client</code></pre>
</div>
</div>
</div>
</div>
<div class=sect2>
<h3 id=_rendu_sur_le_dashboard_dadministration>3.3. Rendu sur le dashboard d‚Äôadministration</h3>
<div class=paragraph>
<p>Affichage des annotations pour tous les clients:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-5188d.png alt=700 width=500>
</div>
</div>
<div class=paragraph>
<p>Affichage des annotation pour un client en particulier:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-1d057.png alt=700 width=500>
</div>
</div>
<div class=paragraph>
<p>ou pour un autre client:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-5205d.png alt=700 width=500>
</div>
</div>
</div>
</div>
</div>
<div class=sect1>
<h2 id=_processus_de_cr√©ation_dun_annotation>4. Processus de cr√©ation d‚Äôun annotation</h2>
<div class=sectionbody>
<div class=sect2>
<h3 id=_cr√©ation_dune_annotation_sur_dashboard_client>4.1. Cr√©ation d‚Äôune annotation sur Dashboard client</h3>
<div class=paragraph>
<p><strong>Cas exemple:</strong> Le client a proc√©d√© √† une campagne de communcation SMS.
Il est souhaitable qu‚Äôil ajoute une annotation dans son Dashboard afin de tracer cette action et pouvoir ainsi la corr√©ler √† un probl√®me ou incident √©ventuel.</p>
</div>
<div class=paragraph>
<p>Depuis le dashboard client, cliquez sur une zone d‚Äôun graphique puis cliquez:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-588b0.png alt=300 width=200>
</div>
</div>
<div class=paragraph>
<p>Ensuite renseignez le message ainsi que les tags propre au client, par exemple:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>extranet
editeur
client:client_xyz</code></pre>
</div>
</div>
<div class=paragraph>
<p>L‚Äôannotation devrait etre visible sur le graphique et les autres graphiques du dashboard s‚Äôil y en a:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-eba4c.png alt=700 width=500>
</div>
</div>
<div class=paragraph>
<p>Contenu de l‚Äôannotation lorsque la souris pointe sur celle-ci:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-2287a.png alt=700 width=500>
</div>
</div>
</div>
<div class=sect2>
<h3 id=_cr√©ation_dune_annotation_sur_dashboard_dadministration_des_clients>4.2. Cr√©ation d‚Äôune annotation sur Dashboard d‚Äôadministration des clients</h3>
<div class=paragraph>
<p><strong>Cas exemple:</strong> Vous avez effectu√© un changement ou un probl√®me est survenu sur l‚Äôinfrastructure de monitoring.
Il est souhaitable que vous ajoutiez une annotation pour qu‚Äôelle soit visible dans le dashboard du client et le votre afin de tracer cette action et pouvoir ainsi la corr√©ler √† un probl√®me ou incident √©ventuel.</p>
</div>
<div class=paragraph>
<p>Depuis le dashboard d‚Äôadministration, cliquez sur une zone d‚Äôun graphique puis cliquez:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-588b0.png alt=300 width=200>
</div>
</div>
<div class=paragraph>
<p>Saisissez les informations et les tags g√©n√©riques ainsi le tag tag sp√©cifique au client:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-e2b09.png alt=700 width=500>
</div>
</div>
<div class=paragraph>
<p>Exemple:</p>
</div>
<div class=listingblock>
<div class=content>
<pre class=highlight><code class=language-bash data-lang=bash>extranet
editeur
client:client_xyz</code></pre>
</div>
</div>
<div class=paragraph>
<p>Puis sauvegardez l‚Äôannotation.</p>
</div>
<div class=paragraph>
<p>L‚Äôannotation devrait etre visible dans votre Dashboard d‚Äôadministration, ainsi que sur le dashboard du client.</p>
</div>
<div class=paragraph>
<p>Vue Dashboard Administration:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-1b98c.png alt=700 width=500>
</div>
</div>
<div class=paragraph>
<p>Vue Dashboard client:</p>
</div>
<div class="imageblock right text-center">
<div class=content>
<img src=../../images/GRAFANA_Annotation_Variables.fr-95d4f.png alt=700 width=500>
</div>
</div>
</div>
</div>
</div>
</div>
<h4 class=page-header>Voir aussi:</h4>
<div class=item>
<h4><a href=/post/grana_loki_annotations/>Affichage des logs LOKI dans une annotation GRAFANA</a></h4>
<h5>December 11, 2020</h5>
<a href=https://www.vincent-gou.fr/tags/grafana><kbd class=item-tag>grafana</kbd></a>
<a href=https://www.vincent-gou.fr/tags/influxdb><kbd class=item-tag>influxdb</kbd></a>
<a href=https://www.vincent-gou.fr/tags/loki><kbd class=item-tag>loki</kbd></a>
</div>
<div class=item>
<h4><a href=/post/promtail_windows_service/>Param√©trage PROMTAIl en tant que service Windows</a></h4>
<h5>July 2, 2020</h5>
<a href=https://www.vincent-gou.fr/tags/grafana><kbd class=item-tag>grafana</kbd></a>
<a href=https://www.vincent-gou.fr/tags/promtail><kbd class=item-tag>promtail</kbd></a>
<a href=https://www.vincent-gou.fr/tags/loki><kbd class=item-tag>loki</kbd></a>
</div>
<h4 class=page-header>Auteur:</h4>
<figure>
<img class=avatar src=../../../images/vincent_photo_resized.png alt>
<figcaption>
<a href=https://www.vincent-gou.fr/authors/vincent-gourrierec/>Vincent Gourrierec</a>
</figcaption>
</figure>
</main>
<footer>
<p class=copyright>2023 - ¬© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a> theme, build with GitHub Actions <img src=https://github.com/vincent-gou/Hugo/workflows/hugo%20publish/badge.svg alt="hugo publish"> and <a href=https://www.vincent-gou.fr>Vincent Gourrierec</a></p>
</footer>
</body>
</html>